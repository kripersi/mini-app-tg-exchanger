{% extends "layout.html" %}

{% block title %}Создание заявки | CryptoExchange{% endblock %}

{% block content %}
<main class="card center">
  <h2>Создайте заявку</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash">
        {% for cat, msg in messages %}
          <div class="flash-item {{ cat }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="post" id="exchangeForm" action="{{ url_for('create') }}">
    <label>Страна</label>
    <select name="country" id="country" required>
      <option value="" selected disabled>Выберите страну</option>
      {% for c in countries %}
        <option value="{{ c.name }}" {% if form and form.country == c.name %} selected {% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>

    <label>Отдаёте валюту</label>
    <select name="give_currency" id="give_currency" required>
      <option value="" selected disabled>Выберите валюту</option>
    </select>

    <label>Получаете валюту</label>
    <select name="get_currency" id="get_currency" required>
      <option value="" selected disabled>Выберите валюту</option>
    </select>

    <label>Город</label>
    <select name="city" id="city" required>
      <option value="" selected disabled>Выберите город</option>
    </select>

    <label>ФИО</label>
    <input type="text" name="fullname" id="fullname"
           value="{{ form.fullname if form else '' }}" required>

    <label>Почта</label>
    <input type="email" name="email" id="email"
           value="{{ form.email if form else '' }}" required>

    <label>Дата и время посещения офиса</label>
    <input type="datetime-local" name="datetime" id="datetime"
           value="{{ form.datetime if form else '' }}" required>

    <!-- Скрытые данные пользователя (автозаполняются из Telegram WebApp) -->
    <input type="hidden" name="user_id">
    <input type="hidden" name="first_name">
    <input type="hidden" name="last_name">
    <input type="hidden" name="username">

    <button type="submit" class="btn">Подтвердить заявку</button>
  </form>
</main>

<div id="notification-container"></div>
{% endblock %}
